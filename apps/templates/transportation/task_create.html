
{% extends 'layouts/base.html' %}

{% load static %}

{% block title %} ایجاد ماموریت {% endblock title %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'forms.css' %}">
{% endblock stylesheets %}

{% block content %}
<div class="container">
    <div class="form-container">
        {% if form.errors %}
        <ul class="errorlist">
            {% for field, errors in form.errors.items %}
                <li><strong>{{ field }}:</strong>
                    <ul>
                        {% for error in errors %}
                            <li style="color: red;">{{ error }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
        <form method="post">
            {% csrf_token %}
            <div class="block-fields">
                <p> {{ form.as_p }} </p>
                <!-- <label for="distance">Distance (km):</label>
                <input type="text" id="distance" name="distance" readonly>
                <button type="button" onclick="openMap()">Select on Map</button> -->
            </div>

            <p><button type="submit" class="submit-btn">ثبت وظیفه</button></p>
        </form>
    </div>
    
</div>
{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
<script>
    function openMap() {
        var mapWindow = window.open('{% url "transportation:map" %}', "Select Route", "width=800,height=600");
        
        window.addEventListener("message", function(event) {
            if (event.data.type === "routeSelected") {
                document.getElementById("point1").value = event.data.point1;
                document.getElementById("point2").value = event.data.point2;
                document.getElementById("distance").value = event.data.distance.toFixed(2);
            }
        }, false);
    }
</script>


<script>
    flatpickr("#datetimepicker", {
        enableTime: true,
        dateFormat: "Y-m-d",
    });
</script>
{% endblock javascripts %}


